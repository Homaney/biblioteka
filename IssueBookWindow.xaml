<Window x:Class="biblioteka.IssueBookWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="📖 Выдача книги"
        Height="654" Width="700"
        WindowStartupLocation="CenterOwner"
        Background="#0F0F0F"
        FontFamily="Segoe UI"
        ResizeMode="NoResize">

    <Window.Resources>
        <!-- Цветовая палитра -->
        <SolidColorBrush x:Key="PrimaryPurple" Color="#8B5CF6"/>
        <SolidColorBrush x:Key="PrimaryPurpleDark" Color="#7C3AED"/>
        <SolidColorBrush x:Key="Success" Color="#10B981"/>
        <SolidColorBrush x:Key="SuccessDark" Color="#059669"/>
        <SolidColorBrush x:Key="Background" Color="#0F0F0F"/>
        <SolidColorBrush x:Key="CardBackground" Color="#1A1A1A"/>
        <SolidColorBrush x:Key="CardBorder" Color="#2D2D2D"/>
        <SolidColorBrush x:Key="TextPrimary" Color="#FFFFFF"/>
        <SolidColorBrush x:Key="TextSecondary" Color="#A1A1AA"/>
        <SolidColorBrush x:Key="InputBackground" Color="#2A2A2A"/>
        <SolidColorBrush x:Key="PlaceholderColor" Color="#666666"/>

        <!-- Стиль для ComboBox с плейсхолдером -->
        <Style x:Key="ComboBoxWithPlaceholder" TargetType="ComboBox">
            <Setter Property="Background" Value="{StaticResource InputBackground}"/>
            <Setter Property="Foreground" Value="{StaticResource TextPrimary}"/>
            <Setter Property="BorderBrush" Value="{StaticResource CardBorder}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="12,10"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Height" Value="44"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ComboBox">
                        <Grid x:Name="templateRoot" SnapsToDevicePixels="true">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition MinWidth="{DynamicResource {x:Static SystemParameters.VerticalScrollBarWidthKey}}" Width="0"/>
                            </Grid.ColumnDefinitions>
                            <Popup x:Name="PART_Popup" AllowsTransparency="true" Grid.ColumnSpan="2" IsOpen="{Binding IsDropDownOpen, RelativeSource={RelativeSource TemplatedParent}}" Margin="1" PopupAnimation="{DynamicResource {x:Static SystemParameters.ComboBoxPopupAnimationKey}}" Placement="Bottom">
                                <Border x:Name="dropDownBorder" Background="{StaticResource InputBackground}" BorderBrush="{StaticResource CardBorder}" BorderThickness="1" CornerRadius="4" MaxHeight="300">
                                    <ScrollViewer x:Name="DropDownScrollViewer">
                                        <Grid x:Name="grid" RenderOptions.ClearTypeHint="Enabled">
                                            <Canvas x:Name="canvas" HorizontalAlignment="Left" Height="0" VerticalAlignment="Top" Width="0">
                                                <Rectangle x:Name="opaqueRect" Fill="{Binding Background, ElementName=dropDownBorder}" Height="{Binding ActualHeight, ElementName=dropDownBorder}" Width="{Binding ActualWidth, ElementName=dropDownBorder}"/>
                                            </Canvas>
                                            <ItemsPresenter x:Name="ItemsPresenter" KeyboardNavigation.DirectionalNavigation="Contained" SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}"/>
                                        </Grid>
                                    </ScrollViewer>
                                </Border>
                            </Popup>
                            <ToggleButton x:Name="toggleButton" Background="{TemplateBinding Background}" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}" Grid.ColumnSpan="2" IsChecked="{Binding IsDropDownOpen, Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}}">
                                <ToggleButton.Template>
                                    <ControlTemplate TargetType="ToggleButton">
                                        <Border Background="{TemplateBinding Background}" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}" CornerRadius="4">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="20"/>
                                                </Grid.ColumnDefinitions>
                                                <ContentPresenter ContentTemplate="{TemplateBinding ContentTemplate}" Content="{TemplateBinding Content}" ContentStringFormat="{TemplateBinding ContentStringFormat}" HorizontalAlignment="Left" Margin="{TemplateBinding Padding}" SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}" VerticalAlignment="{TemplateBinding VerticalContentAlignment}"/>
                                                <Path x:Name="arrow" Grid.Column="1" Data="F1 M 300,-190L 310,-190L 305,-183L 300,-190 Z" Fill="{StaticResource TextSecondary}" HorizontalAlignment="Center" Margin="0" VerticalAlignment="Center"/>
                                            </Grid>
                                        </Border>
                                    </ControlTemplate>
                                </ToggleButton.Template>
                            </ToggleButton>
                            <ContentPresenter x:Name="contentPresenter" ContentTemplate="{TemplateBinding SelectionBoxItemTemplate}" Content="{TemplateBinding SelectionBoxItem}" ContentStringFormat="{TemplateBinding SelectionBoxItemStringFormat}" HorizontalAlignment="Left" IsHitTestVisible="false" Margin="{TemplateBinding Padding}" SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}" VerticalAlignment="{TemplateBinding VerticalContentAlignment}"/>

                            <!-- Плейсхолдер -->
                            <TextBlock x:Name="placeholderText" 
                                      Text="{TemplateBinding Tag}" 
                                      Foreground="{StaticResource PlaceholderColor}" 
                                      Margin="{TemplateBinding Padding}" 
                                      VerticalAlignment="Center"
                                      IsHitTestVisible="False"
                                      Visibility="Collapsed"/>
                        </Grid>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="true">
                                <Setter Property="BorderBrush" Value="{StaticResource PrimaryPurple}"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="false">
                                <Setter Property="Opacity" Value="0.5"/>
                            </Trigger>
                            <Trigger Property="SelectedItem" Value="{x:Null}">
                                <Setter TargetName="placeholderText" Property="Visibility" Value="Visible"/>
                                <Setter TargetName="contentPresenter" Property="Visibility" Value="Collapsed"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style TargetType="ComboBoxItem">
            <Setter Property="Background" Value="{StaticResource InputBackground}"/>
            <Setter Property="Foreground" Value="{StaticResource TextPrimary}"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="12,8"/>
            <Style.Triggers>
                <Trigger Property="IsHighlighted" Value="True">
                    <Setter Property="Background" Value="{StaticResource PrimaryPurple}"/>
                    <Setter Property="Foreground" Value="White"/>
                </Trigger>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="{StaticResource PrimaryPurple}"/>
                    <Setter Property="Foreground" Value="White"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style TargetType="ListBox">
            <Setter Property="Background" Value="{StaticResource InputBackground}"/>
            <Setter Property="Foreground" Value="{StaticResource TextPrimary}"/>
            <Setter Property="BorderBrush" Value="{StaticResource CardBorder}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="ScrollViewer.HorizontalScrollBarVisibility" Value="Disabled"/>
            <Setter Property="ScrollViewer.VerticalScrollBarVisibility" Value="Auto"/>
        </Style>

        <Style TargetType="ListBoxItem">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{StaticResource TextPrimary}"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="12,8"/>
            <Style.Triggers>
                <Trigger Property="IsSelected" Value="True">
                    <Setter Property="Background" Value="{StaticResource PrimaryPurple}"/>
                    <Setter Property="Foreground" Value="White"/>
                </Trigger>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#252525"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style TargetType="DatePicker">
            <Setter Property="Background" Value="{StaticResource InputBackground}"/>
            <Setter Property="Foreground" Value="{StaticResource TextPrimary}"/>
            <Setter Property="BorderBrush" Value="{StaticResource CardBorder}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Height" Value="44"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
        </Style>

        <!-- Стиль для TextBox внутри DatePicker -->
        <Style TargetType="DatePickerTextBox">
            <Setter Property="Background" Value="{StaticResource InputBackground}"/>
            <Setter Property="Foreground" Value="{StaticResource TextPrimary}"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="12,0"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
        </Style>

        <!-- Стиль для кнопок -->
        <Style x:Key="SuccessButton" TargetType="Button">
            <Setter Property="Background" Value="{StaticResource Success}"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="24,12"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Height" Value="44"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="{StaticResource SuccessDark}"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="AddButton" TargetType="Button">
            <Setter Property="Background" Value="{StaticResource PrimaryPurple}"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Width" Value="44"/>
            <Setter Property="Height" Value="44"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="FontSize" Value="16"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="{StaticResource PrimaryPurpleDark}"/>
                </Trigger>
            </Style.Triggers>
        </Style>

    </Window.Resources>

    <Border Margin="10,10,10,8" Background="{StaticResource CardBackground}" CornerRadius="12" BorderBrush="{StaticResource CardBorder}" BorderThickness="1">
        <Grid Margin="25,25,25,-1">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Заголовок -->
            <TextBlock Text="📖 Выдача книги" 
                      Grid.Row="0"
                      FontSize="26" 
                      FontWeight="Bold"
                      Foreground="{StaticResource TextPrimary}" 
                      HorizontalAlignment="Center" 
                      Margin="0,0,0,25"/>

            <!-- Форма -->
            <StackPanel Grid.Row="1" VerticalAlignment="Top">
                <!-- Книга -->
                <TextBlock Text="📕 Книга:" 
                          Foreground="{StaticResource TextSecondary}" 
                          FontSize="14" 
                          FontWeight="SemiBold"
                          Margin="0,0,0,6"/>
                <ComboBox x:Name="BookComboBox" 
                         Style="{StaticResource ComboBoxWithPlaceholder}"
                         Tag="Выберите книгу..."
                         DisplayMemberPath="Title"
                         SelectionChanged="BookComboBox_SelectionChanged"
                         Margin="0,0,0,20"/>

                <!-- Доступные экземпляры -->
                <TextBlock Text="📚 Доступные экземпляры:" 
                          Foreground="{StaticResource TextSecondary}" 
                          FontSize="14" 
                          FontWeight="SemiBold"
                          Margin="0,0,0,6"/>
                <ListBox x:Name="InstanceListBox" 
                        Height="100"
                        DisplayMemberPath="InventoryNumber" 
                        SelectedValuePath="ID"
                        Margin="0,0,0,20"/>

                <!-- Читатель -->
                <TextBlock Text="👤 Читатель:" 
                          Foreground="{StaticResource TextSecondary}" 
                          FontSize="14" 
                          FontWeight="SemiBold"
                          Margin="0,0,0,6"/>
                <Grid Margin="0,0,0,20">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="44"/>
                    </Grid.ColumnDefinitions>
                    <ComboBox x:Name="ReaderComboBox" 
                             Grid.Column="0"
                             Style="{StaticResource ComboBoxWithPlaceholder}"
                             Tag="Выберите читателя..."
                             DisplayMemberPath="FullName"/>
                    <Button Content="➕" 
                            Grid.Column="1"
                            Style="{StaticResource AddButton}"
                            Click="AddReader_Click"
                            Margin="3,0,-8,0"
                            ToolTip="Добавить нового читателя"/>
                </Grid>

                <!-- Даты -->
                <Grid Margin="0,0,0,20">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="15"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <!-- Дата выдачи -->
                    <StackPanel Grid.Column="0">
                        <TextBlock Text="📅 Дата выдачи:" 
                                  Foreground="{StaticResource TextSecondary}" 
                                  FontSize="14" 
                                  FontWeight="SemiBold"
                                  Margin="0,0,0,6"/>
                        <DatePicker x:Name="IssueDatePicker" Height="28"/>
                    </StackPanel>

                    <!-- Дата возврата -->
                    <StackPanel Grid.Column="2">
                        <TextBlock Text="📅 Плановая дата возврата:" 
                                  Foreground="{StaticResource TextSecondary}" 
                                  FontSize="14" 
                                  FontWeight="SemiBold"
                                  Margin="0,0,0,6"/>
                        <DatePicker x:Name="PlannedReturnDatePicker" Height="28"/>
                    </StackPanel>
                </Grid>
            </StackPanel>

            <!-- Кнопка выдачи -->
            <Button Grid.Row="1"
                    Content="✅ Выдать книгу" 
                    Style="{StaticResource SuccessButton}"
                    Width="220"
                    Click="IssueButton_Click" 
                    HorizontalAlignment="Center"
                    Margin="0,433,0,25" Grid.RowSpan="2"/>
        </Grid>
    </Border>
</Window>