<Window x:Class="biblioteka.IssueBookWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="📖 Выдача книги"
        Height="606" Width="500"
        WindowStartupLocation="CenterOwner"
        Background="#0F0F0F"
        FontFamily="Segoe UI"
        ResizeMode="NoResize">

    <Window.Resources>
        <!-- Цветовая палитра -->
        <SolidColorBrush x:Key="PrimaryPurple" Color="#8B5CF6"/>
        <SolidColorBrush x:Key="PrimaryPurpleDark" Color="#7C3AED"/>
        <SolidColorBrush x:Key="Success" Color="#10B981"/>
        <SolidColorBrush x:Key="SuccessDark" Color="#059669"/>
        <SolidColorBrush x:Key="Background" Color="#0F0F0F"/>
        <SolidColorBrush x:Key="CardBackground" Color="#1A1A1A"/>
        <SolidColorBrush x:Key="CardBorder" Color="#2D2D2D"/>
        <SolidColorBrush x:Key="TextPrimary" Color="#FFFFFF"/>
        <SolidColorBrush x:Key="TextSecondary" Color="#A1A1AA"/>
        <SolidColorBrush x:Key="InputBackground" Color="#2A2A2A"/>

        <!-- Базовый стиль для всех элементов управления -->
        <Style TargetType="ComboBox">
            <Setter Property="Background" Value="{StaticResource InputBackground}"/>
            <Setter Property="Foreground" Value="{StaticResource TextPrimary}"/>
            <Setter Property="BorderBrush" Value="{StaticResource CardBorder}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="12,10"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Height" Value="44"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
        </Style>

        <Style TargetType="ComboBoxItem">
            <Setter Property="Background" Value="{StaticResource InputBackground}"/>
            <Setter Property="Foreground" Value="{StaticResource TextPrimary}"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="12,8"/>
            <Style.Triggers>
                <Trigger Property="IsHighlighted" Value="True">
                    <Setter Property="Background" Value="{StaticResource PrimaryPurple}"/>
                    <Setter Property="Foreground" Value="White"/>
                </Trigger>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="{StaticResource PrimaryPurple}"/>
                    <Setter Property="Foreground" Value="White"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style TargetType="ListBox">
            <Setter Property="Background" Value="{StaticResource InputBackground}"/>
            <Setter Property="Foreground" Value="{StaticResource TextPrimary}"/>
            <Setter Property="BorderBrush" Value="{StaticResource CardBorder}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="ScrollViewer.HorizontalScrollBarVisibility" Value="Disabled"/>
            <Setter Property="ScrollViewer.VerticalScrollBarVisibility" Value="Auto"/>
        </Style>

        <Style TargetType="ListBoxItem">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{StaticResource TextPrimary}"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="12,8"/>
            <Style.Triggers>
                <Trigger Property="IsSelected" Value="True">
                    <Setter Property="Background" Value="{StaticResource PrimaryPurple}"/>
                    <Setter Property="Foreground" Value="White"/>
                </Trigger>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#252525"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style TargetType="DatePicker">
            <Setter Property="Background" Value="{StaticResource InputBackground}"/>
            <Setter Property="Foreground" Value="{StaticResource TextPrimary}"/>
            <Setter Property="BorderBrush" Value="{StaticResource CardBorder}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Height" Value="44"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
        </Style>

        <!-- Переопределение системных цветов для DatePicker -->
        <SolidColorBrush x:Key="DatePickerBackground" Color="#2A2A2A"/>
        <SolidColorBrush x:Key="DatePickerForeground" Color="#FFFFFF"/>
        <SolidColorBrush x:Key="DatePickerBorderBrush" Color="#2D2D2D"/>

        <!-- Стиль для TextBox внутри DatePicker -->
        <Style TargetType="DatePickerTextBox">
            <Setter Property="Background" Value="{StaticResource InputBackground}"/>
            <Setter Property="Foreground" Value="{StaticResource TextPrimary}"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="12,0"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
        </Style>

        <!-- Стиль для кнопок -->
        <Style x:Key="SuccessButton" TargetType="Button">
            <Setter Property="Background" Value="{StaticResource Success}"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="24,12"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Height" Value="44"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="{StaticResource SuccessDark}"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="AddButton" TargetType="Button">
            <Setter Property="Background" Value="{StaticResource PrimaryPurple}"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Width" Value="44"/>
            <Setter Property="Height" Value="44"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="FontSize" Value="16"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="{StaticResource PrimaryPurpleDark}"/>
                </Trigger>
            </Style.Triggers>
        </Style>

    </Window.Resources>

    <Border Margin="20" Background="{StaticResource CardBackground}" CornerRadius="8" BorderBrush="{StaticResource CardBorder}" BorderThickness="1">
        <Grid Margin="24">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Заголовок -->
            <TextBlock Text="📖 Выдача книги" 
                      Grid.Row="0"
                      FontSize="24" 
                      FontWeight="Bold"
                      Foreground="{StaticResource TextPrimary}" 
                      HorizontalAlignment="Center" 
                      Margin="0,0,0,20"/>

            <!-- Форма -->
            <StackPanel Grid.Row="1" VerticalAlignment="Top">
                <!-- Книга -->
                <TextBlock Text="Книга:" 
                          Foreground="{StaticResource TextSecondary}" 
                          FontSize="13" 
                          FontWeight="SemiBold"
                          Margin="0,0,0,4"/>
                <ComboBox x:Name="BookComboBox" 
                         DisplayMemberPath="Title" 
                         SelectedValuePath="Identifier" 
                         SelectionChanged="BookComboBox_SelectionChanged"
                         Margin="0,0,0,16"/>

                <!-- Доступные экземпляры -->
                <TextBlock Text="📚 Доступные экземпляры:" 
                          Foreground="{StaticResource TextSecondary}" 
                          FontSize="13" 
                          FontWeight="SemiBold"
                          Margin="0,0,0,4"/>
                <ListBox x:Name="InstanceListBox" 
                        Height="80"
                        DisplayMemberPath="InventoryNumber" 
                        SelectedValuePath="ID"
                        Margin="0,0,0,16"/>

                <!-- Читатель -->
                <TextBlock Text="👤 Читатель:" 
                          Foreground="{StaticResource TextSecondary}" 
                          FontSize="13" 
                          FontWeight="SemiBold"
                          Margin="0,0,0,4"/>
                <Grid Margin="0,0,0,16">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="44"/>
                    </Grid.ColumnDefinitions>
                    <ComboBox x:Name="ReaderComboBox" 
                             Grid.Column="0"
                             DisplayMemberPath="FullName" 
                             SelectedValuePath="ID"/>
                    <Button Content="➕" 
                            Grid.Column="1"
                            Style="{StaticResource AddButton}"
                            Click="AddReader_Click"
                            Margin="8,0,0,0"
                            ToolTip="Добавить нового читателя"/>
                </Grid>

                <!-- Даты -->
                <Grid Margin="0,0,0,16">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="16"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <!-- Дата выдачи -->
                    <StackPanel Grid.Column="0">
                        <TextBlock Text="📅 Дата выдачи:" 
                                  Foreground="{StaticResource TextSecondary}" 
                                  FontSize="13" 
                                  FontWeight="SemiBold"
                                  Margin="0,0,0,4"/>
                        <DatePicker x:Name="IssueDatePicker"/>
                    </StackPanel>

                    <!-- Пробел -->
                    <Rectangle Grid.Column="1" Fill="Transparent"/>

                    <!-- Дата возврата -->
                    <StackPanel Grid.Column="2">
                        <TextBlock Text="📅 Плановая дата возврата:" 
                                  Foreground="{StaticResource TextSecondary}" 
                                  FontSize="13" 
                                  FontWeight="SemiBold"
                                  Margin="0,0,0,4"/>
                        <DatePicker x:Name="PlannedReturnDatePicker"/>
                    </StackPanel>
                </Grid>
            </StackPanel>

            <!-- Кнопка выдачи -->
            <Button Grid.Row="2"
                    Content="✅ Выдать книгу" 
                    Style="{StaticResource SuccessButton}"
                    Width="200"
                    Click="IssueButton_Click" 
                    HorizontalAlignment="Center"
                    Margin="0,20,0,0"/>
        </Grid>
    </Border>
</Window>