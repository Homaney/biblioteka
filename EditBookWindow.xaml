<Window x:Class="biblioteka.EditBookWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Редактирование книги"
        Height="800" Width="600"
        WindowStartupLocation="CenterOwner"
        Background="#0F0F0F"
        FontFamily="Segoe UI"
        ResizeMode="NoResize">

    <Window.Resources>
        <!-- Цветовая палитра -->
        <SolidColorBrush x:Key="PrimaryPurple" Color="#8B5CF6"/>
        <SolidColorBrush x:Key="PrimaryPurpleDark" Color="#7C3AED"/>
        <SolidColorBrush x:Key="Success" Color="#10B981"/>
        <SolidColorBrush x:Key="SuccessDark" Color="#059669"/>
        <SolidColorBrush x:Key="Danger" Color="#EF4444"/>
        <SolidColorBrush x:Key="DangerDark" Color="#DC2626"/>
        <SolidColorBrush x:Key="Info" Color="#3B82F6"/>
        <SolidColorBrush x:Key="InfoDark" Color="#2563EB"/>
        <SolidColorBrush x:Key="Warning" Color="#F59E0B"/>
        <SolidColorBrush x:Key="Background" Color="#0F0F0F"/>
        <SolidColorBrush x:Key="CardBackground" Color="#1A1A1A"/>
        <SolidColorBrush x:Key="CardBorder" Color="#2D2D2D"/>
        <SolidColorBrush x:Key="TextPrimary" Color="#FFFFFF"/>
        <SolidColorBrush x:Key="TextSecondary" Color="#A1A1AA"/>
        <SolidColorBrush x:Key="TextTertiary" Color="#71717A"/>

        <!-- Стиль для TextBox -->
        <Style x:Key="ModernTextBox" TargetType="TextBox">
            <Setter Property="Background" Value="{StaticResource CardBackground}"/>
            <Setter Property="Foreground" Value="{StaticResource TextPrimary}"/>
            <Setter Property="BorderBrush" Value="{StaticResource CardBorder}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="12,10"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="CaretBrush" Value="{StaticResource PrimaryPurple}"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
        </Style>

        <!-- Стиль для ComboBox-like TextBox со стрелочкой -->
        <Style x:Key="ComboBoxLikeTextBox" TargetType="TextBox" BasedOn="{StaticResource ModernTextBox}">
            <Setter Property="IsReadOnly" Value="True"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Padding" Value="12,10,36,10"/>
        </Style>

        <!-- Стиль для кликабельного Border -->
        <Style x:Key="ClickableBorder" TargetType="Border">
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Background" Value="Transparent"/>
        </Style>

        <!-- Стиль для MenuItem -->
        <Style x:Key="DarkMenuItem" TargetType="MenuItem">
            <Setter Property="Background" Value="{StaticResource CardBackground}"/>
            <Setter Property="Foreground" Value="{StaticResource TextPrimary}"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="12,8"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="{StaticResource PrimaryPurple}"/>
                    <Setter Property="Foreground" Value="White"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="PrimaryButton" TargetType="Button">
            <Setter Property="Background" Value="{StaticResource PrimaryPurple}"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="16,10"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border" 
                                Background="{TemplateBinding Background}"
                                CornerRadius="6">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"
                                              Margin="{TemplateBinding Padding}"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="{StaticResource PrimaryPurpleDark}"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#6D28D9"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="SuccessButton" TargetType="Button" BasedOn="{StaticResource PrimaryButton}">
            <Setter Property="Background" Value="{StaticResource Success}"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="{StaticResource SuccessDark}"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="DangerButton" TargetType="Button" BasedOn="{StaticResource PrimaryButton}">
            <Setter Property="Background" Value="{StaticResource Danger}"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="{StaticResource DangerDark}"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="TagButton" TargetType="Button">
            <Setter Property="Background" Value="#374151"/>
            <Setter Property="Foreground" Value="{StaticResource TextPrimary}"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="12,6"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border" 
                                Background="{TemplateBinding Background}"
                                CornerRadius="16">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="20"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Text="{TemplateBinding Content}" 
                                           Grid.Column="0"
                                           VerticalAlignment="Center"
                                           Margin="4,0,2,0"/>
                                <TextBlock Text="×" 
                                           Grid.Column="1"
                                           FontWeight="Bold"
                                           FontSize="14"
                                           HorizontalAlignment="Center"
                                           VerticalAlignment="Center"/>
                            </Grid>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="{StaticResource Danger}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

    </Window.Resources>

    <Border Margin="20" Background="{StaticResource CardBackground}" CornerRadius="8" BorderBrush="{StaticResource CardBorder}" BorderThickness="1">
        <ScrollViewer VerticalScrollBarVisibility="Auto">
            <StackPanel Margin="24">
                <!-- Заголовок -->
                <TextBlock Text="✏️ Редактирование книги" 
                          FontSize="24" 
                          FontWeight="Bold"
                          Foreground="{StaticResource TextPrimary}" 
                          HorizontalAlignment="Center" 
                          Margin="0,0,0,16"/>

                <!-- ID книги -->
                <TextBlock x:Name="IdentifierLabel" 
                          Text="ID: " 
                          FontSize="16" 
                          FontWeight="SemiBold"
                          Foreground="{StaticResource PrimaryPurple}" 
                          HorizontalAlignment="Center" 
                          Margin="0,0,0,20"/>

                <!-- Название -->
                <TextBlock Text="Название книги" 
                          Foreground="{StaticResource TextSecondary}" 
                          FontSize="13" 
                          FontWeight="SemiBold"
                          Margin="0,0,0,6"/>
                <TextBox x:Name="TitleBox" 
                        Style="{StaticResource ModernTextBox}"
                        Height="40"
                        GotFocus="TextBox_GotFocus"/>

                <!-- Авторы -->
                <TextBlock Text="Авторы" 
                          Foreground="{StaticResource TextSecondary}" 
                          FontSize="13" 
                          FontWeight="SemiBold"
                          Margin="0,16,0,6"/>

                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <!-- Поле выбора автора со стрелочкой -->
                    <Border Grid.Column="0" 
                            Style="{StaticResource ClickableBorder}"
                            MouseDown="AuthorsTextBox_MouseDown">
                        <Grid>
                            <TextBox x:Name="AuthorsTextBox"
                                     Style="{StaticResource ComboBoxLikeTextBox}"
                                     Height="40"
                                     Tag="Выберите автора..."
                                     IsHitTestVisible="False"
                                     GotFocus="TextBox_GotFocus"/>
                            <!-- Стрелочка -->
                            <Path x:Name="AuthorsArrow"
                                  Data="M0,0 L4,4 8,0 z"
                                  Fill="{StaticResource TextSecondary}"
                                  HorizontalAlignment="Right"
                                  VerticalAlignment="Center"
                                  Margin="0,0,12,0"
                                  Stretch="Uniform"
                                  Width="12"
                                  Height="8"
                                  IsHitTestVisible="False"/>
                        </Grid>
                    </Border>

                    <Button Content="➕ Добавить" 
                            Grid.Column="1" 
                            Margin="8,0,0,0"
                            Style="{StaticResource PrimaryButton}"
                            Click="AddAuthor_Click"
                            Padding="12,10"/>
                </Grid>

                <!-- Выбранные авторы -->
                <TextBlock Text="Выбранные авторы:" 
                          Foreground="{StaticResource TextSecondary}" 
                          FontSize="12" 
                          Margin="0,12,0,6"/>

                <Border Background="{StaticResource CardBackground}" 
                        BorderBrush="{StaticResource CardBorder}" 
                        BorderThickness="1" 
                        CornerRadius="6" 
                        Height="80" 
                        Margin="0,0,0,12" 
                        Padding="8">
                    <ScrollViewer>
                        <ItemsControl x:Name="SelectedAuthorsList">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Button Content="{Binding}" 
                                            Style="{StaticResource TagButton}"
                                            Click="RemoveAuthor_Click"
                                            Margin="0,2,4,2"/>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <WrapPanel/>
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                        </ItemsControl>
                    </ScrollViewer>
                </Border>

                <!-- УДК -->
                <TextBlock Text="УДК" 
                          Foreground="{StaticResource TextSecondary}" 
                          FontSize="13" 
                          FontWeight="SemiBold"
                          Margin="0,0,0,6"/>

                <!-- Поле выбора УДК со стрелочкой -->
                <Border Style="{StaticResource ClickableBorder}" 
                        MouseDown="UDKTextBox_MouseDown">
                    <Grid>
                        <TextBox x:Name="UDKTextBox"
                                 Style="{StaticResource ComboBoxLikeTextBox}"
                                 Height="40"
                                 Tag="Выберите УДК..."
                                 IsHitTestVisible="False"
                                 GotFocus="TextBox_GotFocus"/>
                        <!-- Стрелочка -->
                        <Path x:Name="UDKArrow"
                              Data="M0,0 L4,4 8,0 z"
                              Fill="{StaticResource TextSecondary}"
                              HorizontalAlignment="Right"
                              VerticalAlignment="Center"
                              Margin="0,0,12,0"
                              Stretch="Uniform"
                              Width="12"
                              Height="8"
                              IsHitTestVisible="False"/>
                    </Grid>
                </Border>

                <!-- Год -->
                <TextBlock Text="Год издания" 
                          Foreground="{StaticResource TextSecondary}" 
                          FontSize="13" 
                          FontWeight="SemiBold"
                          Margin="0,16,0,6"/>
                <TextBox x:Name="YearBox" 
                        Style="{StaticResource ModernTextBox}"
                        Height="40"
                        Margin="0,0,0,12"
                        GotFocus="TextBox_GotFocus"/>

                <!-- Описание -->
                <TextBlock Text="Описание" 
                          Foreground="{StaticResource TextSecondary}" 
                          FontSize="13" 
                          FontWeight="SemiBold"
                          Margin="0,0,0,6"/>
                <TextBox x:Name="DescriptionBox" 
                        Style="{StaticResource ModernTextBox}"
                        Height="80" 
                        AcceptsReturn="True" 
                        TextWrapping="Wrap"
                        VerticalScrollBarVisibility="Auto"
                        Margin="0,0,0,16"
                        GotFocus="TextBox_GotFocus"/>

                <!-- Управление экземплярами -->
                <Border Background="{StaticResource CardBackground}" 
                        BorderBrush="{StaticResource PrimaryPurple}" 
                        BorderThickness="1" 
                        CornerRadius="8" 
                        Padding="16" 
                        Margin="0,0,0,20">
                    <StackPanel>
                        <TextBlock Text="📚 Управление экземплярами" 
                                  Foreground="{StaticResource PrimaryPurple}" 
                                  FontSize="14" 
                                  FontWeight="Bold"
                                  Margin="0,0,0,12"/>

                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <TextBlock x:Name="InstancesCountText"
                                      Text="Загрузка..."
                                      Foreground="{StaticResource TextSecondary}"
                                      FontSize="13"
                                      Grid.Column="0"
                                      VerticalAlignment="Center"/>

                            <Button Content="➕ Добавить" 
                                    Style="{StaticResource SuccessButton}"
                                    Grid.Column="1"
                                    Margin="8,0,4,0"
                                    Click="AddInstance_Click"/>

                            <Button Content="🗑️ Удалить" 
                                    Style="{StaticResource DangerButton}"
                                    Grid.Column="2"
                                    Margin="4,0,0,0"
                                    Click="RemoveInstance_Click"/>
                        </Grid>

                        <TextBlock Text="* Добавляет/удаляет экземпляры с статусом 'На полке'" 
                                  Foreground="{StaticResource TextTertiary}" 
                                  FontSize="11" 
                                  Margin="0,8,0,0"/>
                    </StackPanel>
                </Border>

                <!-- Кнопка сохранения -->
                <Button Content="💾 Сохранить изменения" 
                        Style="{StaticResource SuccessButton}"
                        Click="SaveChanges_Click"
                        Height="44"
                        FontSize="15"
                        Padding="24,12"/>
            </StackPanel>
        </ScrollViewer>
    </Border>
</Window>