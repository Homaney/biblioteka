<Window x:Class="biblioteka.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Научно-техническая библиотека - Каталог книг"
        Height="750" Width="1200"
        WindowStartupLocation="CenterScreen"
        Background="#0F0F0F"
        FontFamily="Segoe UI">

    <Window.Resources>
        <!-- Цветовая палитра -->
        <SolidColorBrush x:Key="PrimaryPurple" Color="#8B5CF6"/>
        <SolidColorBrush x:Key="PrimaryPurpleDark" Color="#7C3AED"/>
        <SolidColorBrush x:Key="Success" Color="#10B981"/>
        <SolidColorBrush x:Key="SuccessDark" Color="#059669"/>
        <SolidColorBrush x:Key="Danger" Color="#EF4444"/>
        <SolidColorBrush x:Key="DangerDark" Color="#DC2626"/>
        <SolidColorBrush x:Key="Info" Color="#3B82F6"/>
        <SolidColorBrush x:Key="InfoDark" Color="#2563EB"/>
        <SolidColorBrush x:Key="Warning" Color="#F59E0B"/>
        <SolidColorBrush x:Key="Background" Color="#0F0F0F"/>
        <SolidColorBrush x:Key="CardBackground" Color="#1A1A1A"/>
        <SolidColorBrush x:Key="CardBorder" Color="#2D2D2D"/>
        <SolidColorBrush x:Key="TextPrimary" Color="#FFFFFF"/>
        <SolidColorBrush x:Key="TextSecondary" Color="#A1A1AA"/>
        <SolidColorBrush x:Key="TextTertiary" Color="#71717A"/>

        <!-- Стили для кнопок -->
        <Style x:Key="ModernButton" TargetType="Button">
            <Setter Property="Background" Value="{StaticResource CardBackground}"/>
            <Setter Property="Foreground" Value="{StaticResource TextPrimary}"/>
            <Setter Property="BorderBrush" Value="{StaticResource CardBorder}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="16,12"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border" 
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="8">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"
                                              Margin="{TemplateBinding Padding}"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#252525"/>
                                <Setter TargetName="border" Property="BorderBrush" Value="#404040"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#2A2A2A"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="PrimaryButton" BasedOn="{StaticResource ModernButton}" TargetType="Button">
            <Setter Property="Background" Value="{StaticResource PrimaryPurple}"/>
            <Setter Property="BorderBrush" Value="{StaticResource PrimaryPurple}"/>
            <Setter Property="Foreground" Value="White"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="{StaticResource PrimaryPurpleDark}"/>
                    <Setter Property="BorderBrush" Value="{StaticResource PrimaryPurpleDark}"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="SuccessButton" BasedOn="{StaticResource ModernButton}" TargetType="Button">
            <Setter Property="Background" Value="{StaticResource Success}"/>
            <Setter Property="BorderBrush" Value="{StaticResource Success}"/>
            <Setter Property="Foreground" Value="White"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="{StaticResource SuccessDark}"/>
                    <Setter Property="BorderBrush" Value="{StaticResource SuccessDark}"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="DangerButton" BasedOn="{StaticResource ModernButton}" TargetType="Button">
            <Setter Property="Background" Value="{StaticResource Danger}"/>
            <Setter Property="BorderBrush" Value="{StaticResource Danger}"/>
            <Setter Property="Foreground" Value="White"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="{StaticResource DangerDark}"/>
                    <Setter Property="BorderBrush" Value="{StaticResource DangerDark}"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- Упрощенный стиль для TextBox с плейсхолдером -->
        <Style x:Key="SearchTextBox" TargetType="TextBox">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{StaticResource TextPrimary}"/>
            <Setter Property="BorderBrush" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="0"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="CaretBrush" Value="{StaticResource PrimaryPurple}"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="VerticalAlignment" Value="Stretch"/>
            <Setter Property="HorizontalAlignment" Value="Stretch"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TextBox">
                        <Border x:Name="border" 
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}">
                            <ScrollViewer x:Name="PART_ContentHost" 
                                          Margin="0"
                                          Padding="0"
                                          VerticalAlignment="Center"
                                          HorizontalAlignment="Left"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Стиль для DataGrid -->
        <Style x:Key="ModernDataGrid" TargetType="DataGrid">
            <Setter Property="Background" Value="{StaticResource CardBackground}"/>
            <Setter Property="Foreground" Value="{StaticResource TextPrimary}"/>
            <Setter Property="BorderBrush" Value="{StaticResource CardBorder}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="RowBackground" Value="Transparent"/>
            <Setter Property="AlternatingRowBackground" Value="#151515"/>
            <Setter Property="HorizontalGridLinesBrush" Value="{StaticResource CardBorder}"/>
            <Setter Property="VerticalGridLinesBrush" Value="Transparent"/>
            <Setter Property="HeadersVisibility" Value="Column"/>
            <Setter Property="ScrollViewer.CanContentScroll" Value="True"/>
            <Setter Property="ScrollViewer.PanningMode" Value="Both"/>
            <Setter Property="Stylus.IsFlicksEnabled" Value="False"/>
            <Setter Property="AutoGenerateColumns" Value="False"/>
            <Setter Property="CanUserAddRows" Value="False"/>
            <Setter Property="CanUserDeleteRows" Value="False"/>
            <Setter Property="CanUserReorderColumns" Value="False"/>
            <Setter Property="CanUserResizeColumns" Value="True"/>
            <Setter Property="CanUserResizeRows" Value="False"/>
            <Setter Property="CanUserSortColumns" Value="True"/>
            <Setter Property="IsReadOnly" Value="True"/>
            <Setter Property="SelectionMode" Value="Single"/>
            <Setter Property="SelectionUnit" Value="FullRow"/>
        </Style>

        <Style x:Key="DataGridColumnHeaderStyle" TargetType="DataGridColumnHeader">
            <Setter Property="Background" Value="#1A1A1A"/>
            <Setter Property="Foreground" Value="{StaticResource TextSecondary}"/>
            <Setter Property="BorderBrush" Value="{StaticResource CardBorder}"/>
            <Setter Property="BorderThickness" Value="0,0,0,1"/>
            <Setter Property="Padding" Value="12,8"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="HorizontalContentAlignment" Value="Left"/>
            <Setter Property="Cursor" Value="Hand"/>
        </Style>

        <Style TargetType="DataGridRow">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderBrush" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#252525"/>
                </Trigger>
                <Trigger Property="IsSelected" Value="True">
                    <Setter Property="Background" Value="{StaticResource PrimaryPurple}"/>
                    <Setter Property="Foreground" Value="White"/>
                </Trigger>
            </Style.Triggers>
        </Style>

    </Window.Resources>

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Заголовок и статистика -->
        <Grid Grid.Row="0" Margin="0,0,0,20">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <StackPanel Grid.Column="0">
                <TextBlock Text="📚 Каталог книг" 
                          FontSize="32" 
                          FontWeight="Bold" 
                          Foreground="{StaticResource TextPrimary}"/>
                <TextBlock x:Name="StatsTextBlock" 
                          Text="Загрузка..." 
                          FontSize="14" 
                          Foreground="{StaticResource TextSecondary}"
                          Margin="0,4,0,0"/>
            </StackPanel>

            <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                <Button Content="➕ Добавить книгу" 
                        Click="AddBook_Click" 
                        Style="{StaticResource SuccessButton}"
                        Margin="0,0,8,0"/>
                <Button Content="🗑️ Удалить" 
                        Click="DeleteBook_Click" 
                        Style="{StaticResource DangerButton}"
                        Margin="0,0,8,0"/>
            </StackPanel>
        </Grid>

        <!-- Панель поиска и фильтров -->
        <Border Grid.Row="1" 
                Background="{StaticResource CardBackground}" 
                BorderBrush="{StaticResource CardBorder}"
                BorderThickness="1" 
                CornerRadius="8" 
                Padding="16" 
                Margin="0,0,0,16">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- Поиск с лупой и плейсхолдером -->
                <Border Grid.Column="0" 
                        Background="{StaticResource CardBackground}" 
                        BorderBrush="{StaticResource CardBorder}"
                        BorderThickness="1" 
                        CornerRadius="6"
                        Width="400" 
                        Height="44">
                    <Grid>
                        <!-- Лупа -->
                        <TextBlock Text="🔍" 
                                   FontSize="16"
                                   Foreground="{StaticResource TextTertiary}"
                                   VerticalAlignment="Center"
                                   HorizontalAlignment="Left"
                                   Margin="12,0,0,0"
                                   IsHitTestVisible="False"/>

                        <!-- Поле поиска -->
                        <TextBox x:Name="SearchBox" 
                                Style="{StaticResource SearchTextBox}"
                                Background="Transparent"
                                BorderThickness="0"
                                Padding="40,0,12,0"
                                VerticalContentAlignment="Center"
                                TextChanged="SearchBox_TextChanged"
                                GotFocus="SearchBox_GotFocus"
                                LostFocus="SearchBox_LostFocus"/>

                        <!-- Плейсхолдер -->
                        <TextBlock x:Name="SearchPlaceholder"
                                   Text="Поиск по названию, автору, УДК..."
                                   Foreground="{StaticResource TextTertiary}"
                                   VerticalAlignment="Center"
                                   HorizontalAlignment="Left"
                                   Margin="40,0,12,0"
                                   IsHitTestVisible="False">
                            <TextBlock.Style>
                                <Style TargetType="TextBlock">
                                    <Setter Property="Visibility" Value="Visible"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding Text, ElementName=SearchBox}" Value="">
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </DataTrigger>
                                        <DataTrigger Binding="{Binding Text, ElementName=SearchBox}" Value="{x:Null}">
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBlock.Style>
                        </TextBlock>
                    </Grid>
                </Border>

                <!-- Действия -->
                <StackPanel Grid.Column="1" 
                           Orientation="Horizontal" 
                           HorizontalAlignment="Right"
                           VerticalAlignment="Center">
                    <Button Content="📋 Выдать книгу" 
                            Click="IssueBook_Click" 
                            Style="{StaticResource PrimaryButton}"
                            Margin="8,0,8,0"/>
                    <Button Content="👥 Читатели" 
                            Click="ViewReaders_Click" 
                            Style="{StaticResource ModernButton}"
                            Margin="0,0,8,0"/>
                    <Button Content="📖 УДК" 
                            Click="ViewUDK_Click" 
                            Style="{StaticResource ModernButton}"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Таблица книг -->
        <Border Grid.Row="3" 
                Background="{StaticResource CardBackground}" 
                BorderBrush="{StaticResource CardBorder}"
                BorderThickness="1" 
                CornerRadius="8">
            <DataGrid x:Name="BooksDataGrid"
                     Style="{StaticResource ModernDataGrid}"
                     MouseDoubleClick="BooksDataGrid_MouseDoubleClick"
                     ToolTip="Двойной клик для редактирования книги">
                <DataGrid.Columns>
                    <DataGridTextColumn Header="ID" 
                                      Binding="{Binding Identifier}" 
                                      Width="70" 
                                      HeaderStyle="{StaticResource DataGridColumnHeaderStyle}"/>
                    <DataGridTextColumn Header="Название" 
                                      Binding="{Binding Title}" 
                                      Width="2.5*" 
                                      HeaderStyle="{StaticResource DataGridColumnHeaderStyle}"/>
                    <DataGridTextColumn Header="Авторы" 
                                      Binding="{Binding Author}" 
                                      Width="2*" 
                                      HeaderStyle="{StaticResource DataGridColumnHeaderStyle}"/>
                    <DataGridTextColumn Header="Год" 
                                      Binding="{Binding Yearr}" 
                                      Width="80" 
                                      HeaderStyle="{StaticResource DataGridColumnHeaderStyle}"/>
                    <DataGridTextColumn Header="УДК" 
                                      Binding="{Binding UDKCode}" 
                                      Width="120" 
                                      HeaderStyle="{StaticResource DataGridColumnHeaderStyle}"/>
                    <DataGridTextColumn Header="Доступно" 
                                      Binding="{Binding AvailableInstances}" 
                                      Width="80" 
                                      HeaderStyle="{StaticResource DataGridColumnHeaderStyle}"/>
                    <DataGridTextColumn Header="Описание" 
                                      Binding="{Binding Description}" 
                                      Width="3*" 
                                      HeaderStyle="{StaticResource DataGridColumnHeaderStyle}"/>
                </DataGrid.Columns>
            </DataGrid>
        </Border>

        <!-- Статус бар -->
        <Border Grid.Row="4" 
                Background="{StaticResource CardBackground}" 
                BorderBrush="{StaticResource CardBorder}"
                BorderThickness="1,0,1,1" 
                CornerRadius="0,0,8,8" 
                Padding="12,8">
            <TextBlock x:Name="StatusTextBlock" 
                      Text="Готово" 
                      Foreground="{StaticResource TextSecondary}" 
                      FontSize="12"/>
        </Border>
    </Grid>
</Window>